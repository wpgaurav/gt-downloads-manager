(()=>{"use strict";var e={n:a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return e.d(t,{a:t}),t},d:(a,t)=>{for(var l in t)e.o(t,l)&&!e.o(a,l)&&Object.defineProperty(a,l,{enumerable:!0,get:t[l]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.wp.blocks,t=window.wp.blockEditor,l=window.wp.components,n=window.wp.element,o=window.wp.i18n,s=window.wp.serverSideRender;var r=e.n(s);const d=window.wp.apiFetch;var i=e.n(d);const g=window.wp.url,u=window.ReactJSXRuntime;function m({label:e,value:a,onChange:t,type:s}){const[r,d]=(0,n.useState)([]),[m,c]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let e=!0;const t=setTimeout(async()=>{c(!0);try{const t=(0,g.addQueryArgs)(`/gtdm/v2/terms/${s}`,{search:a||"",per_page:8}),l=await i()({path:t});e&&d(Array.isArray(l)?l:[])}catch(a){e&&d([])}finally{e&&c(!1)}},300);return()=>{e=!1,clearTimeout(t)}},[s,a]),(0,u.jsxs)("div",{className:"gtdm-term-control",style:{marginBottom:"16px"},children:[(0,u.jsx)(l.TextControl,{label:e,value:a,onChange:t}),m&&(0,u.jsx)(l.Spinner,{}),r.length>0&&(0,u.jsx)("div",{className:"gtdm-term-suggestions","aria-label":(0,o.__)("Suggestions","gt-downloads-manager"),style:{marginTop:"10px",marginBottom:"6px",display:"flex",flexWrap:"wrap",gap:"6px"},children:r.map(e=>(0,u.jsx)(l.Button,{variant:"secondary",isSmall:!0,onClick:()=>t(e.slug),children:e.name},e.slug))})]})}function c({selectedId:e,onSelect:a}){const[t,s]=(0,n.useState)(""),[r,d]=(0,n.useState)([]),[m,c]=(0,n.useState)(""),[p,w]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let a=!0;return e?((async()=>{try{const t=await i()({path:`/gtdm/v2/downloads/${e}`});a&&t&&t.title&&(c(t.title),s(t.title))}catch(e){a&&c("")}})(),()=>{a=!1}):(c(""),()=>{a=!1})},[e]),(0,n.useEffect)(()=>{let e=!0;const a=setTimeout(async()=>{w(!0);try{const a=(0,g.addQueryArgs)("/gtdm/v2/downloads/search",{search:t||"",per_page:8}),l=await i()({path:a});e&&d(Array.isArray(l)?l:[])}catch(a){e&&d([])}finally{e&&w(!1)}},300);return()=>{e=!1,clearTimeout(a)}},[t]),(0,u.jsxs)("div",{className:"gtdm-download-search-control",children:[(0,u.jsx)(l.TextControl,{label:(0,o.__)("Download name","gt-downloads-manager"),value:t,help:(0,o.__)("Leave empty to use the latest published download.","gt-downloads-manager"),onChange:s}),(0,u.jsxs)("div",{style:{marginTop:"8px",display:"flex",gap:"8px",alignItems:"center",flexWrap:"wrap"},children:[(0,u.jsx)(l.Button,{variant:"tertiary",onClick:()=>{a(0),c(""),s("")},children:(0,o.__)("Use latest published","gt-downloads-manager")}),e>0&&(0,u.jsxs)("span",{children:[(0,o.__)("Selected:","gt-downloads-manager")," ",m||(0,o.__)("Loadingâ€¦","gt-downloads-manager")]})]}),p&&(0,u.jsx)(l.Spinner,{}),r.length>0&&(0,u.jsx)("div",{className:"gtdm-download-suggestions","aria-label":(0,o.__)("Download suggestions","gt-downloads-manager"),style:{marginTop:"8px",display:"flex",flexWrap:"wrap",gap:"6px"},children:r.map(t=>(0,u.jsx)(l.Button,{variant:Number(e)===Number(t.id)?"primary":"secondary",isSmall:!0,onClick:()=>{a(Number(t.id)),c(t.title),s(t.title)},children:t.title},t.id))})]})}(0,a.registerBlockType)("gtdm/downloads-query",{apiVersion:3,title:(0,o.__)("GT Downloads Query","gt-downloads-manager"),icon:"download",category:"widgets",attributes:{category:{type:"string",default:""},tag:{type:"string",default:""},search:{type:"string",default:""},sort:{type:"string",default:"newest"},perPage:{type:"number",default:12},page:{type:"number",default:1},layout:{type:"string",default:"grid"},filters:{type:"boolean",default:!0},image:{type:"string",default:"medium"}},edit:({attributes:e,setAttributes:a})=>(0,u.jsxs)(n.Fragment,{children:[(0,u.jsx)(t.InspectorControls,{children:(0,u.jsxs)(l.PanelBody,{title:(0,o.__)("Query settings","gt-downloads-manager"),initialOpen:!0,children:[(0,u.jsx)(m,{label:(0,o.__)("Category slug","gt-downloads-manager"),type:"categories",value:e.category,onChange:e=>a({category:e})}),(0,u.jsx)(m,{label:(0,o.__)("Tag slug","gt-downloads-manager"),type:"tags",value:e.tag,onChange:e=>a({tag:e})}),(0,u.jsx)("div",{style:{marginBottom:"16px"},children:(0,u.jsx)(l.TextControl,{label:(0,o.__)("Default search","gt-downloads-manager"),value:e.search,onChange:e=>a({search:e})})}),(0,u.jsx)("div",{style:{marginBottom:"16px"},children:(0,u.jsx)(l.SelectControl,{label:(0,o.__)("Sort","gt-downloads-manager"),value:e.sort,options:[{label:(0,o.__)("Newest first","gt-downloads-manager"),value:"newest"},{label:(0,o.__)("Oldest first","gt-downloads-manager"),value:"oldest"},{label:(0,o.__)("Most downloaded","gt-downloads-manager"),value:"popular"},{label:(0,o.__)("Title A-Z","gt-downloads-manager"),value:"title_asc"},{label:(0,o.__)("Title Z-A","gt-downloads-manager"),value:"title_desc"}],onChange:e=>a({sort:e})})}),(0,u.jsx)("div",{style:{marginBottom:"16px"},children:(0,u.jsx)(l.RangeControl,{label:(0,o.__)("Items per page","gt-downloads-manager"),value:e.perPage,min:1,max:50,onChange:e=>a({perPage:e||12})})}),(0,u.jsx)("div",{style:{marginBottom:"16px"},children:(0,u.jsx)(l.SelectControl,{label:(0,o.__)("Layout","gt-downloads-manager"),value:e.layout,options:[{label:(0,o.__)("Grid","gt-downloads-manager"),value:"grid"},{label:(0,o.__)("Table","gt-downloads-manager"),value:"table"}],onChange:e=>a({layout:e})})}),(0,u.jsx)("div",{style:{marginTop:"4px"},children:(0,u.jsx)(l.ToggleControl,{label:(0,o.__)("Show filters","gt-downloads-manager"),checked:!!e.filters,onChange:e=>a({filters:!!e})})})]})}),(0,u.jsx)(r(),{block:"gtdm/downloads-query",attributes:e})]}),save:()=>null}),(0,a.registerBlockType)("gtdm/download-filters",{apiVersion:3,title:(0,o.__)("GT Download Filters","gt-downloads-manager"),icon:"filter",category:"widgets",attributes:{category:{type:"string",default:""},tag:{type:"string",default:""},search:{type:"string",default:""},sort:{type:"string",default:"newest"}},edit:({attributes:e,setAttributes:a})=>(0,u.jsxs)(n.Fragment,{children:[(0,u.jsx)(t.InspectorControls,{children:(0,u.jsxs)(l.PanelBody,{title:(0,o.__)("Default filter values","gt-downloads-manager"),initialOpen:!0,children:[(0,u.jsx)(m,{label:(0,o.__)("Category slug","gt-downloads-manager"),type:"categories",value:e.category,onChange:e=>a({category:e})}),(0,u.jsx)(m,{label:(0,o.__)("Tag slug","gt-downloads-manager"),type:"tags",value:e.tag,onChange:e=>a({tag:e})}),(0,u.jsx)("div",{style:{marginBottom:"16px"},children:(0,u.jsx)(l.TextControl,{label:(0,o.__)("Default search","gt-downloads-manager"),value:e.search,onChange:e=>a({search:e})})}),(0,u.jsx)("div",{style:{marginBottom:"8px"},children:(0,u.jsx)(l.SelectControl,{label:(0,o.__)("Sort","gt-downloads-manager"),value:e.sort,options:[{label:(0,o.__)("Newest first","gt-downloads-manager"),value:"newest"},{label:(0,o.__)("Oldest first","gt-downloads-manager"),value:"oldest"},{label:(0,o.__)("Most downloaded","gt-downloads-manager"),value:"popular"},{label:(0,o.__)("Title A-Z","gt-downloads-manager"),value:"title_asc"},{label:(0,o.__)("Title Z-A","gt-downloads-manager"),value:"title_desc"}],onChange:e=>a({sort:e})})})]})}),(0,u.jsx)(r(),{block:"gtdm/download-filters",attributes:e})]}),save:()=>null}),(0,a.registerBlockType)("gtdm/download-card",{apiVersion:3,title:(0,o.__)("GT Download Card","gt-downloads-manager"),icon:"download",category:"widgets",attributes:{id:{type:"number",default:0},image:{type:"string",default:"medium"}},edit:({attributes:e,setAttributes:a})=>(0,u.jsxs)(n.Fragment,{children:[(0,u.jsx)(t.InspectorControls,{children:(0,u.jsxs)(l.PanelBody,{title:(0,o.__)("Card settings","gt-downloads-manager"),initialOpen:!0,children:[(0,u.jsx)(c,{selectedId:e.id,onSelect:e=>a({id:Number(e)||0})}),(0,u.jsx)(l.SelectControl,{label:(0,o.__)("Image size","gt-downloads-manager"),value:e.image,options:[{label:(0,o.__)("Thumbnail","gt-downloads-manager"),value:"thumbnail"},{label:(0,o.__)("Medium","gt-downloads-manager"),value:"medium"},{label:(0,o.__)("Large","gt-downloads-manager"),value:"large"},{label:(0,o.__)("Full","gt-downloads-manager"),value:"full"}],onChange:e=>a({image:e})})]})}),(0,u.jsx)(r(),{block:"gtdm/download-card",attributes:e})]}),save:()=>null})})();